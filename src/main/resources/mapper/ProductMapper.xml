<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    商品Mapper XMLマッピングファイル
    対応API：demo.mapper.ProductMapper
-->
<mapper namespace="demo.mapper.ProductMapper">

    <!-- マッピング結果 -->
    <resultMap id="BaseResultMap" type="demo.entity.Product">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="product_name" property="productName" jdbcType="VARCHAR"/>
        <result column="product_code" property="productCode" jdbcType="VARCHAR"/>
        <result column="category" property="category" jdbcType="VARCHAR"/>
        <result column="price" property="price" jdbcType="DECIMAL"/>
        <result column="stock" property="stock" jdbcType="INTEGER"/>
        <result column="description" property="description" jdbcType="VARCHAR"/>
        <result column="status" property="status" jdbcType="TINYINT"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="update_time" property="updateTime" jdbcType="TIMESTAMP"/>
    </resultMap>

    <!-- 商品データまとめ -->
    <sql id="Base_Column_List">
        id, product_name, product_code, category, price, stock, description, status, create_time, update_time
    </sql>

    <!-- すべて商品リスト検索 リスト画面に商品データ表示-->
    <select id="findAll" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM product
    </select>
    
    <!-- 商品ID条件で検索 ID検索結果で更新画面に遷移-->
    <select id="findById" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM product
        WHERE id = #{id}
    </select>
    
    <!-- 商品データ更新 -->
    <delete id="update" parameterType = "demo.entity.Product">
      UPDATE product
       <set>
         <if test = "productName != null and productName != ''">
         	product_name = #{productName},
         </if>
         <if test = "productCode != null and productCode != ''">
        		product_code = #{productCode},
         </if>
         <if test = "category != null">
         	category = #{category},
         </if>
          <if test = "price != null">
         	price = #{price},
         </if>
          <if test = "stock != null">
         	stock = #{stock},
         </if>
          <if test = "description != null">
         	description = #{description},
         </if>
          <if test = "status != null">
         	status = #{status},
         </if>
       </set>
       WHERE id = #{id}
    </delete>
    
    <!-- 商品追加でコード条件で検索 -->
    <select id="findByproductCode" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM product
        WHERE product_Code = #{productCode}
    </select>
    
    <!-- 商品名条件で検索 -->
    <select id="findBysearchName" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM product
        WHERE product_Name LIKE CONCAT('%', #{productName}, '%')
    </select>
    
 	<!--   商品データ追加  -->
	<insert id="insert" parameterType="demo.entity.Product" useGeneratedKeys = "true" keyProperty="id">
	INSERT INTO product(product_name, product_code, category, price, stock, description, status)
	VALUES (#{productName}, #{productCode}, #{category}, #{price}, #{stock}, #{description}, #{status})
	</insert>   
    
	<!-- 商品ID条件で削除 -->
    <delete id="deleteById">
        DELETE FROM product WHERE id = #{id}
    </delete>
  
</mapper>
